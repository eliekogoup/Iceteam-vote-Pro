(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[138],{415:(e,r,s)=>{"use strict";s.d(r,{A:()=>u});var a=s(7876),t=s(9099),n=s(8230),i=s.n(n),l=s(6930);function u(e){let{className:r=""}=e,s=(0,t.useRouter)(),{user:n,member:u,isAdmin:c,signOut:o}=(0,l.A)();return n?(0,a.jsx)("nav",{className:"global-nav ".concat(r),children:(0,a.jsxs)("div",{className:"nav-container",children:[(0,a.jsxs)("div",{className:"nav-left",children:[(0,a.jsx)(i(),{href:"/",className:"nav-button ".concat("/"===s.pathname?"active":""),children:"\uD83C\uDFE0 Accueil"}),(0,a.jsx)(i(),{href:"/vote",className:"nav-button ".concat("/vote"===s.pathname?"active":""),children:"\uD83D\uDDF3️ Voter"}),c&&(0,a.jsx)(i(),{href:"/admin",className:"nav-button ".concat(s.pathname.startsWith("/admin")?"active":""),children:"⚙️ Administration"})]}),(0,a.jsxs)("div",{className:"nav-right",children:[(0,a.jsxs)("span",{className:"user-info",children:[(null==u?void 0:u.name)||n.email,c&&(0,a.jsx)("span",{className:"admin-indicator",children:"\uD83D\uDC51"})]}),(0,a.jsx)("button",{onClick:o,className:"nav-button logout",children:"\uD83D\uDEAA D\xe9connexion"})]})]})}):null}},2211:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>c});var a=s(7876),t=s(4232),n=s(4613),i=s(4531),l=s(415),u=s(8313);function c(){let[e,r]=(0,t.useState)([]),[s,c]=(0,t.useState)([]),[o,d]=(0,t.useState)(!0),[m,h]=(0,t.useState)(!0),[p,g]=(0,t.useState)(!1),[x,v]=(0,t.useState)("");(0,t.useEffect)(()=>{!async function(){try{let e=await (0,i._)();g(e)}catch(e){console.error("❌ Erreur v\xe9rification admin:",e),g(!1)}finally{h(!1)}}()},[]),(0,t.useEffect)(()=>{p&&!m&&j()},[p,m]);let j=async()=>{d(!0),await Promise.all([f(),N()]),d(!1)},f=async()=>{let{data:e,error:s}=await n.N.from("super_admins").select("*").order("created_at");s?console.error("Erreur lors du chargement des super-admins:",s):r(e||[])},N=async()=>{let{data:e,error:r}=await n.N.from("auth.users").select("id, email, created_at").order("created_at");r?console.error("Erreur lors du chargement des utilisateurs:",r):c(e||[])},b=async e=>{if(e.preventDefault(),!x)return void alert("Veuillez s\xe9lectionner un utilisateur");try{let e=s.find(e=>e.email===x);if(!e)return void alert("Utilisateur non trouv\xe9");let{error:r}=await n.N.from("super_admins").insert([{user_id:e.id,email:e.email}]);r?alert("Erreur lors de l'ajout: "+r.message):(v(""),await f(),alert("Super-admin ajout\xe9 avec succ\xe8s !"))}catch(e){alert("Erreur: "+e.message)}},_=async(e,r)=>{if(confirm("\xcates-vous s\xfbr de vouloir retirer les droits super-admin \xe0 ".concat(r," ?"))){let{error:r}=await n.N.from("super_admins").delete().eq("id",e);r?alert("Erreur lors de la suppression: "+r.message):(await f(),alert("Super-admin retir\xe9 avec succ\xe8s !"))}};return m?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.A,{}),(0,a.jsx)("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 60px)"},children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]})})]}):p?(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)(u.A,{isAdmin:p}),(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)("h1",{children:"\uD83D\uDD11 Gestion des Super-Admins"}),(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-yellow-800 font-semibold mb-2",children:"⚠️ Attention"}),(0,a.jsx)("p",{className:"text-yellow-700",children:"Les super-admins ont un acc\xe8s total \xe0 l'administration m\xeame sans \xeatre dans la table membres. Utilisez cette fonctionnalit\xe9 avec pr\xe9caution."})]}),(0,a.jsxs)("form",{onSubmit:b,style:{marginBottom:"30px",padding:"20px",border:"1px solid #ddd",borderRadius:"8px"},children:[(0,a.jsx)("h3",{children:"Ajouter un Super-Admin"}),(0,a.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,a.jsx)("label",{children:"Utilisateur :"}),(0,a.jsxs)("select",{value:x,onChange:e=>v(e.target.value),required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"},children:[(0,a.jsx)("option",{value:"",children:"-- Choisir un utilisateur --"}),s.filter(r=>!e.some(e=>e.user_id===r.id)).map(e=>(0,a.jsxs)("option",{value:e.email,children:[e.email," (cr\xe9\xe9 le ",new Date(e.created_at).toLocaleDateString(),")"]},e.id))]})]}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:"\uD83D\uDD11 Ajouter Super-Admin"})]}),o?(0,a.jsx)("div",{className:"warning",children:"Chargement..."}):(0,a.jsx)(a.Fragment,{children:0===e.length?(0,a.jsx)("div",{className:"warning",children:"Aucun super-admin configur\xe9."}):(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Cr\xe9\xe9 le"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.id}),(0,a.jsx)("td",{children:(0,a.jsxs)("span",{style:{color:"#22c55e",fontWeight:"bold"},children:["\uD83D\uDD11 ",e.email]})}),(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{onClick:()=>_(e.id,e.email),className:"btn-danger small",children:"\uD83D\uDDD1️ Retirer"})})]},e.id))})]})})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.A,{}),(0,a.jsx)("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 60px)"},children:(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto",children:(0,a.jsxs)("div",{className:"text-red-800 text-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Acc\xe8s refus\xe9"}),(0,a.jsx)("p",{children:"Vous devez \xeatre administrateur pour acc\xe9der \xe0 cette page."})]})})})]})}},4531:(e,r,s)=>{"use strict";s.d(r,{_:()=>t}),s(4232);var a=s(4613);async function t(){try{let{data:{user:e}}=await a.N.auth.getUser();if(!e)return!1;let{data:r,error:s}=await a.N.from("super_admins").select("id").eq("user_id",e.id).eq("is_active",!0).single();if(!s&&r)return console.log("\uD83D\uDD11 Super-admin d\xe9tect\xe9 via table super_admins:",e.email),!0;let{data:t}=await a.N.from("members").select("is_admin").eq("user_id",e.id).single(),n=!!(null==t?void 0:t.is_admin);return console.log("\uD83D\uDD0D V\xe9rification admin membre:",{found:!!t,is_admin:null==t?void 0:t.is_admin,result:n}),n}catch(e){return console.error("Erreur lors de la v\xe9rification des droits admin:",e),!1}}},4613:(e,r,s)=>{"use strict";s.d(r,{N:()=>a});let a=(0,s(166).UU)("https://gllqzajfkkvpwnyultiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsbHF6YWpma2t2cHdueXVsdGl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODczNjcsImV4cCI6MjA3NDY2MzM2N30.B5gXCuB2XCpT11W6unXPhFC2WX-2TsPsJA7PA32qK8E")},6930:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var a=s(4232),t=s(4613),n=s(4531);let i=()=>{let[e,r]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[l,u]=(0,a.useState)(!0),[c,o]=(0,a.useState)(!1),d=async(e,r)=>{try{var s;console.log("\uD83D\uDD0D Recherche membre avec authUserId:",e,"email:",r);let{data:a,error:n}=await t.N.from("members").select("\n          *,\n          member_groups(\n            groups(*)\n          )\n        ").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche par user_id:",{data:a,error:n}),n||!a){console.log("\uD83D\uDD0D Recherche par email...");let{data:s,error:i}=await t.N.from("members").select("\n            *,\n            member_groups(\n              groups(*)\n            )\n          ").eq("email",r).single();console.log("\uD83D\uDCCA R\xe9sultat recherche par email:",{emailData:s,emailError:i}),s&&!i&&(await t.N.from("members").update({user_id:e}).eq("id",s.id),a=s,n=i)}if(n||!a)return console.log("❌ Membre non trouv\xe9:",null==n?void 0:n.message),null;console.log("✅ Donn\xe9es membre brutes:",a);let i={...a,groups:(null==(s=a.member_groups)?void 0:s.map(e=>e.groups))||[]};return console.log("✅ Membre avec groupes:",i),i}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du membre:",e),null}},m=async()=>{try{let{data:{user:e}}=await t.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let s={id:e.id,email:e.email,user_metadata:e.user_metadata};r(e=>(null==e?void 0:e.id)===s.id?e:s),console.log("\uD83D\uDC64 User state mis \xe0 jour:",s);let a=await d(e.id,e.email);i(e=>(null==e?void 0:e.user_id)===(null==a?void 0:a.user_id)?e:a),console.log("\uD83D\uDC65 Member state mis \xe0 jour:",a)}else console.log("❌ Aucun utilisateur authentifi\xe9"),r(null),i(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),r(null),i(null)}finally{u(!1)}},h=async(e,r)=>{try{u(!0);let{error:s}=await t.N.auth.signInWithPassword({email:e,password:r});if(s)return{error:s.message};return await m(),{}}catch(e){return{error:"Erreur lors de la connexion"}}},p=async(e,r,s)=>{try{u(!0);let{error:a}=await t.N.auth.signUp({email:e,password:r,options:{data:{full_name:s}}});if(a)return{error:a.message};return{}}catch(e){return{error:"Erreur lors de l'inscription"}}},g=async()=>{u(!0),await t.N.auth.signOut(),r(null),i(null),u(!1)};return(0,a.useEffect)(()=>{m();let{data:{subscription:e}}=t.N.auth.onAuthStateChange(async(e,s)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await m():"SIGNED_OUT"===e&&(r(null),i(null),u(!1))});return()=>e.unsubscribe()},[]),(0,a.useEffect)(()=>{!async function(){if(null==e?void 0:e.id){let r=await (0,n._)();o(r),console.log("\uD83D\uDD11 \xc9tat admin mis \xe0 jour:",{user:e.email,isAdmin:r})}else o(!1)}()},[null==e?void 0:e.id]),{user:e,member:s,isLoading:l,isAdmin:c,signIn:h,signUp:p,signOut:g,refreshUser:m}}},7670:(e,r,s)=>{"use strict";s.d(r,{W:()=>n});var a=s(4232),t=s(4613);let n=()=>{let[e,r]=(0,a.useState)(null),[s,n]=(0,a.useState)(null),[i,l]=(0,a.useState)(!0),u=async(e,r)=>{try{console.log("\uD83D\uDD0D Recherche super admin avec authUserId:",e,"email:",r);let{data:s,error:a}=await t.N.from("super_admins").select("*").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche super admin:",{data:s,error:a}),a||!s)return console.log("❌ Super admin non trouv\xe9:",null==a?void 0:a.message),null;return console.log("✅ Super admin trouv\xe9:",s),s}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du super admin:",e),null}},c=async()=>{try{let{data:{user:e}}=await t.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let s={id:e.id,email:e.email,user_metadata:e.user_metadata};r(e=>(null==e?void 0:e.id)===s.id?e:s),console.log("\uD83D\uDC64 User state mis \xe0 jour:",s);let a=await u(e.id,e.email);n(e=>(null==e?void 0:e.user_id)===(null==a?void 0:a.user_id)?e:a),console.log("\uD83D\uDC51 Super admin state mis \xe0 jour:",a)}else console.log("❌ Aucun utilisateur authentifi\xe9"),r(null),n(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),r(null),n(null)}finally{l(!1)}},o=async(e,r)=>{try{l(!0);let{error:s}=await t.N.auth.signInWithPassword({email:e,password:r});if(s)return{error:s.message};return{}}catch(e){return{error:e.message||"Une erreur est survenue"}}finally{l(!1)}},d=async()=>{await t.N.auth.signOut(),r(null),n(null)};(0,a.useEffect)(()=>{c();let e=t.N.auth.onAuthStateChange(async e=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await c():"SIGNED_OUT"===e&&(r(null),n(null),l(!1))});return()=>e.data.subscription.unsubscribe()},[]);let m=!!s;return(0,a.useEffect)(()=>{},[s,m]),{user:e,superAdmin:s,isLoading:i,isSuperAdmin:m,signIn:o,signOut:d,refreshUser:c}}},8313:(e,r,s)=>{"use strict";s.d(r,{A:()=>c});var a=s(7876),t=s(8230),n=s.n(t),i=s(9099),l=s(6930),u=s(7670);function c(e){let{isAdmin:r}=e,s=(0,i.useRouter)(),{user:t,member:c,signOut:o}=(0,l.A)(),{isSuperAdmin:d}=(0,u.W)(),m=r||d;return(0,a.jsx)("nav",{children:(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:(0,a.jsx)(n(),{href:"/",className:"/"===s.pathname?"active":"",children:"\uD83C\uDFE0 Accueil"})}),(0,a.jsx)("li",{children:(0,a.jsx)(n(),{href:"/identite",className:"/identite"===s.pathname?"active":"",children:"\uD83D\uDDF3️ Voter"})}),m&&(0,a.jsx)("li",{children:(0,a.jsx)(n(),{href:"/admin",className:s.pathname.startsWith("/admin")?"active":"",children:"⚙️ Administration"})}),t&&(0,a.jsxs)("li",{className:"nav-user-section",children:[(0,a.jsxs)("div",{className:"nav-user-info",children:[(0,a.jsx)("span",{className:"nav-user-name",children:c?"".concat(c.prenom," ").concat(c.nom):t.email}),m&&(0,a.jsx)("span",{className:"nav-admin-badge",children:d?"Super Admin":"Admin"})]}),(0,a.jsx)("button",{onClick:o,className:"nav-logout-btn",children:"D\xe9connexion"})]}),!t&&(0,a.jsx)("li",{children:(0,a.jsx)(n(),{href:"/auth/login",className:"/auth/login"===s.pathname?"active":"",children:"\uD83D\uDD10 Connexion"})})]})})}},8316:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/super-admins",function(){return s(2211)}])}},e=>{e.O(0,[166,8,636,593,792],()=>e(e.s=8316)),_N_E=e.O()}]);