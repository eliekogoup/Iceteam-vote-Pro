(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{415:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var n=s(7876),i=s(9099),t=s(8230),a=s.n(t),l=s(6930);function o(e){let{className:r=""}=e,s=(0,i.useRouter)(),{user:t,member:o,isAdmin:u,signOut:c}=(0,l.A)();return t?(0,n.jsx)("nav",{className:"global-nav ".concat(r),children:(0,n.jsxs)("div",{className:"nav-container",children:[(0,n.jsxs)("div",{className:"nav-left",children:[(0,n.jsx)(a(),{href:"/",className:"nav-button ".concat("/"===s.pathname?"active":""),children:"\uD83C\uDFE0 Accueil"}),(0,n.jsx)(a(),{href:"/vote",className:"nav-button ".concat("/vote"===s.pathname?"active":""),children:"\uD83D\uDDF3️ Voter"}),u&&(0,n.jsx)(a(),{href:"/admin",className:"nav-button ".concat(s.pathname.startsWith("/admin")?"active":""),children:"⚙️ Administration"})]}),(0,n.jsxs)("div",{className:"nav-right",children:[(0,n.jsxs)("span",{className:"user-info",children:[(null==o?void 0:o.name)||t.email,u&&(0,n.jsx)("span",{className:"admin-indicator",children:"\uD83D\uDC51"})]}),(0,n.jsx)("button",{onClick:c,className:"nav-button logout",children:"\uD83D\uDEAA D\xe9connexion"})]})]})}):null}},3135:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>d});var n=s(7876),i=s(4232),t=s(9099),a=s(4613),l=s(4531),o=s(3610),u=s(415),c=s(8313);function d(){(0,t.useRouter)();let[e,r]=(0,i.useState)(!0),[s,d]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!0),[g,h]=(0,i.useState)([]),[x,f]=(0,i.useState)([]),[b,j]=(0,i.useState)(!1),[v,_]=(0,i.useState)(null),[y,N]=(0,i.useState)({nom:"",prenom:"",email:"",name:"",group_id:0,group_ids:[],is_admin:!1});(0,i.useEffect)(()=>{!async function(){try{let e=await (0,l._)();console.log("\uD83D\uDD11 V\xe9rification admin membres:",e),d(e)}catch(e){console.error("❌ Erreur v\xe9rification admin:",e),d(!1)}finally{p(!1)}}()},[]),(0,i.useEffect)(()=>{async function e(){s&&(await E(),await w()),r(!1)}m||e()},[s,m]);let E=async()=>{let{data:e,error:r}=await a.N.from("members").select("\n        *,\n        member_groups(\n          groups(id, name)\n        )\n      ").order("id");r?console.error("Erreur lors du chargement des membres:",r):h((e||[]).map(e=>{var r;return{...e,groups:(null==(r=e.member_groups)?void 0:r.map(e=>e.groups))||[]}}))},w=async()=>{let{data:e,error:r}=await a.N.from("groups").select("*").order("id");if(r)console.error("Erreur lors du chargement des groupes:",r),alert("Erreur lors du chargement des groupes. Assurez-vous qu'au moins un groupe existe.");else{let r=e||[];f(r),r.length>0&&N(e=>({...e,group_id:r[0].id,group_ids:[r[0].id]}))}},D=async e=>{e.preventDefault();try{if(0===x.length)return void alert("Aucun groupe disponible. Veuillez d'abord cr\xe9er des groupes.");if(0===y.group_ids.length)return void alert("Veuillez s\xe9lectionner au moins un groupe");let e=y.group_ids[0],r=x.find(r=>r.id===e);if(!r&&x.length>0){let s=x[0];console.log("⚠️ Groupe ".concat(e," n'existe plus, utilisation du groupe ").concat(s.id," (").concat(s.name,")")),N(e=>({...e,group_id:s.id,group_ids:[s.id]})),r=s}if(!r)return void alert("Aucun groupe valide disponible. Veuillez recharger la page et cr\xe9er des groupes.");let s={group_id:r.id,is_admin:y.is_admin};if(console.log("\uD83D\uDD0D Groupe final utilis\xe9:",r.id,"Nom:",r.name),y.nom&&y.prenom&&y.email){s.nom=y.nom,s.prenom=y.prenom,s.email=y.email,s.name="".concat(y.prenom," ").concat(y.nom);try{let e=await fetch("/api/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y.email.toLowerCase(),password:"temp123!"})}),r=await e.json();e.ok&&r.user?(s.user_id=r.user.id,console.log("✅ Compte utilisateur cr\xe9\xe9:",r.user.email)):console.warn("⚠️ Impossible de cr\xe9er le compte utilisateur:",r.error)}catch(e){console.warn("⚠️ Erreur lors de la cr\xe9ation du compte utilisateur:",e)}}else{if(!y.name)return void alert("Veuillez remplir soit Nom+Pr\xe9nom+Email, soit le Nom complet");s.name=y.name}console.log("\uD83D\uDCDD Donn\xe9es membre \xe0 ins\xe9rer:",s),console.log("\uD83D\uDD0D Colonnes \xe0 ins\xe9rer:",Object.keys(s)),console.log("\uD83C\uDFAF Valeurs \xe0 ins\xe9rer:",Object.values(s)),console.log("\uD83D\uDE80 Tentative d'insertion dans la table members...");let{data:n,error:i}=await a.N.from("members").insert([s]).select().single();if(i){console.error("❌ Erreur d\xe9taill\xe9e insertion membre:",i),console.error("\uD83D\uDCCA Code erreur:",i.code),console.error("\uD83D\uDCCB D\xe9tails:",i.details),console.error("\uD83D\uDCA1 Hint:",i.hint),console.error("\uD83D\uDD0D Message complet:",JSON.stringify(i,null,2)),console.error("\uD83D\uDCCB Donn\xe9es qui ont caus\xe9 l'erreur:",JSON.stringify(s,null,2)),alert("Erreur lors de l'ajout: "+i.message+" (Code: "+i.code+")");return}let t=y.group_ids.map(e=>({member_id:n.id,group_id:e})),{error:l}=await a.N.from("member_groups").insert(t);l&&console.error("Erreur lors de l'ajout des groupes:",l),C(),j(!1),await E(),y.email?alert("Membre ajout\xe9 avec succ\xe8s !\n\n✅ Compte utilisateur cr\xe9\xe9 pour ".concat(y.email,"\n\uD83D\uDCA1 Mot de passe temporaire: temp123!\n\uD83D\uDD04 L'utilisateur peut maintenant r\xe9initialiser son mot de passe.")):alert("Membre ajout\xe9 avec succ\xe8s !")}catch(e){alert("Erreur: "+e.message)}},A=async e=>{if(e.preventDefault(),v)try{if(0===y.group_ids.length)return void alert("Veuillez s\xe9lectionner au moins un groupe");let e={group_id:y.group_ids[0],is_admin:y.is_admin};if(y.nom&&y.prenom&&y.email)e.nom=y.nom,e.prenom=y.prenom,e.email=y.email,e.name="".concat(y.prenom," ").concat(y.nom);else{if(!y.name)return void alert("Veuillez remplir soit Nom+Pr\xe9nom+Email, soit le Nom complet");e.name=y.name}let{error:r}=await a.N.from("members").update(e).eq("id",v.id);if(r)return void alert("Erreur lors de la modification: "+r.message);let{error:s}=await a.N.from("member_groups").delete().eq("member_id",v.id);s&&console.error("Erreur lors de la suppression des groupes:",s);let n=y.group_ids.map(e=>({member_id:v.id,group_id:e})),{error:i}=await a.N.from("member_groups").insert(n);i&&console.error("Erreur lors de l'ajout des groupes:",i),C(),_(null),j(!1),await E(),alert("Membre modifi\xe9 avec succ\xe8s !")}catch(e){alert("Erreur: "+e.message)}},C=()=>{N({nom:"",prenom:"",email:"",name:"",group_id:x.length>0?x[0].id:1,group_ids:[],is_admin:!1})},S=async e=>{let r=g.find(r=>r.id===e);if(!r)return void alert("Membre introuvable");await (0,o.Ke)(r,"le membre",e=>I(e),e=>e.id,o.EG,()=>E(),["Cette action supprimera aussi tous les votes de ce membre","Toutes les associations de groupes seront supprim\xe9es"])},I=e=>e.nom&&e.prenom?"".concat(e.prenom," ").concat(e.nom):e.name||"Nom non d\xe9fini";return m||e?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(u.A,{}),(0,n.jsx)("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 60px)"},children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement..."})]})})]}):s?(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)(c.A,{isAdmin:s}),(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsx)("h1",{children:"\uD83D\uDC65 Gestion des Membres"}),b?(0,n.jsxs)("form",{onSubmit:v?A:D,style:{marginBottom:"30px",padding:"20px",border:"1px solid #ddd",borderRadius:"8px"},children:[(0,n.jsx)("h3",{children:v?"✏️ Modifier le membre":"Ajouter un nouveau membre"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Pr\xe9nom :"}),(0,n.jsx)("input",{type:"text",placeholder:"Pr\xe9nom",value:y.prenom,onChange:e=>N({...y,prenom:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Nom :"}),(0,n.jsx)("input",{type:"text",placeholder:"Nom",value:y.nom,onChange:e=>N({...y,nom:e.target.value}),required:!0})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{children:"Email :"}),(0,n.jsx)("input",{type:"email",placeholder:"email@exemple.com",value:y.email,onChange:e=>N({...y,email:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{children:"Groupes :"}),(0,n.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"12px",maxHeight:"120px",overflowY:"auto"},children:[x.map(e=>(0,n.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",id:"group-".concat(e.id),checked:y.group_ids.includes(e.id),onChange:r=>{if(r.target.checked)N({...y,group_ids:[...y.group_ids,e.id],group_id:0===y.group_ids.length?e.id:y.group_id});else{let r=y.group_ids.filter(r=>r!==e.id);N({...y,group_ids:r,group_id:r.length>0?r[0]:e.id})}},style:{marginRight:"8px"}}),(0,n.jsx)("label",{htmlFor:"group-".concat(e.id),style:{margin:0,cursor:"pointer"},children:e.name})]},e.id)),0===x.length&&(0,n.jsx)("p",{style:{margin:0,color:"#666",fontStyle:"italic"},children:"Aucun groupe disponible"})]}),0===y.group_ids.length&&(0,n.jsx)("p",{style:{color:"#d32f2f",fontSize:"0.875rem",margin:"4px 0 0 0"},children:"⚠️ Veuillez s\xe9lectionner au moins un groupe"})]}),(0,n.jsx)("div",{style:{marginBottom:"16px"},children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",checked:y.is_admin,onChange:e=>N({...y,is_admin:e.target.checked})})," ","Administrateur"]})}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,n.jsx)("button",{type:"submit",className:"btn-primary",children:v?"✏️ Modifier":"➕ Ajouter"}),(0,n.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>{_(null),C(),j(!1)},children:"❌ Annuler"})]})]}):(0,n.jsx)("button",{onClick:()=>j(!0),className:"btn-primary",style:{marginBottom:"20px"},children:"➕ Ajouter un membre"}),0===g.length?(0,n.jsx)("div",{className:"warning",children:"Aucun membre trouv\xe9. Ajoutez votre premier membre ci-dessus."}):(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"ID"}),(0,n.jsx)("th",{children:"Nom"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Groupes"}),(0,n.jsx)("th",{children:"Admin"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:g.map(e=>{let r=e.groups&&e.groups.length>0?e.groups:x.filter(r=>r.id===e.group_id);return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsx)("td",{children:I(e)}),(0,n.jsx)("td",{children:e.email||(0,n.jsx)("span",{style:{color:"#999",fontStyle:"italic"},children:"⚠️ Pas d'email"})}),(0,n.jsx)("td",{children:r.length>0?(0,n.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:r.map((e,r)=>(0,n.jsx)("span",{style:{backgroundColor:"#e3f2fd",color:"#1565c0",padding:"2px 8px",borderRadius:"12px",fontSize:"0.875rem",border:"1px solid #90caf9"},children:e.name},e.id))}):(0,n.jsx)("span",{style:{color:"#999",fontStyle:"italic"},children:"Aucun groupe"})}),(0,n.jsx)("td",{children:e.is_admin?(0,n.jsx)("span",{style:{color:"#22c55e",fontWeight:"bold"},children:"✅ Admin"}):(0,n.jsx)("span",{style:{color:"#6b7280"},children:"\uD83D\uDC64 Membre"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,n.jsx)("button",{onClick:()=>(e=>{var r;_(e);let s=(null==(r=e.groups)?void 0:r.map(e=>e.id))||(e.group_id?[e.group_id]:[]);N({nom:e.nom||"",prenom:e.prenom||"",email:e.email||"",name:e.name||"",group_id:e.group_id,group_ids:s,is_admin:e.is_admin}),j(!0)})(e),className:"btn-secondary small",children:"✏️ Modifier"}),(0,n.jsx)("button",{onClick:()=>S(e.id),className:"btn-danger small",children:"\uD83D\uDDD1️ Supprimer"})]})})]},e.id)})})]})]})]}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(u.A,{}),(0,n.jsx)("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 60px)"},children:(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto",children:(0,n.jsxs)("div",{className:"text-red-800 text-center",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Acc\xe8s refus\xe9"}),(0,n.jsx)("p",{children:"Vous devez \xeatre administrateur pour acc\xe9der \xe0 cette page."})]})})})]})}},3610:(e,r,s)=>{"use strict";s.d(r,{EG:()=>i,Ke:()=>l,UJ:()=>a,cq:()=>t});var n=s(4613);async function i(e){try{let{data:r,error:s}=await n.N.rpc("delete_member_safely",{member_id_to_delete:e});if(s)return console.error("Erreur suppression membre:",s),{success:!1,message:"Erreur lors de la suppression: ".concat(s.message)};return{success:!0,message:r||"Membre supprim\xe9 avec succ\xe8s"}}catch(e){return console.error("Erreur inattendue:",e),{success:!1,message:"Erreur inattendue lors de la suppression"}}}async function t(e){try{let{data:r,error:s}=await n.N.rpc("delete_edition_safely",{edition_id_to_delete:e});if(s)return console.error("Erreur suppression \xe9dition:",s),{success:!1,message:"Erreur lors de la suppression: ".concat(s.message)};return{success:!0,message:r||"\xc9dition supprim\xe9e avec succ\xe8s"}}catch(e){return console.error("Erreur inattendue:",e),{success:!1,message:"Erreur inattendue lors de la suppression"}}}async function a(e){try{let{data:r,error:s}=await n.N.rpc("delete_question_safely",{question_id_to_delete:e});if(s)return console.error("Erreur suppression question:",s),{success:!1,message:"Erreur lors de la suppression: ".concat(s.message)};return{success:!0,message:r||"Question supprim\xe9e avec succ\xe8s"}}catch(e){return console.error("Erreur inattendue:",e),{success:!1,message:"Erreur inattendue lors de la suppression"}}}async function l(e,r,s,n,i,t,a){let l,o=s(e),u=n(e);if(l="\xcates-vous s\xfbr de vouloir supprimer ".concat(r,' "').concat(o,'" ?'),a&&a.length>0&&(l+="\n\n⚠️ ATTENTION:\n"+a.join("\n")),confirm(l+="\n\nCette action est irr\xe9versible."))try{let e=await i(u);e.success?alert("✅ ".concat(e.message)):alert("❌ ".concat(e.message)),e.success&&t&&t()}catch(e){console.error("Erreur lors de la suppression:",e),alert("❌ Erreur inattendue lors de la suppression")}}},4531:(e,r,s)=>{"use strict";s.d(r,{_:()=>i}),s(4232);var n=s(4613);async function i(){try{let{data:{user:e}}=await n.N.auth.getUser();if(!e)return!1;let{data:r,error:s}=await n.N.from("super_admins").select("id").eq("user_id",e.id).eq("is_active",!0).single();if(!s&&r)return console.log("\uD83D\uDD11 Super-admin d\xe9tect\xe9 via table super_admins:",e.email),!0;let{data:i}=await n.N.from("members").select("is_admin").eq("user_id",e.id).single(),t=!!(null==i?void 0:i.is_admin);return console.log("\uD83D\uDD0D V\xe9rification admin membre:",{found:!!i,is_admin:null==i?void 0:i.is_admin,result:t}),t}catch(e){return console.error("Erreur lors de la v\xe9rification des droits admin:",e),!1}}},4613:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});let n=(0,s(166).UU)("https://gllqzajfkkvpwnyultiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsbHF6YWpma2t2cHdueXVsdGl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODczNjcsImV4cCI6MjA3NDY2MzM2N30.B5gXCuB2XCpT11W6unXPhFC2WX-2TsPsJA7PA32qK8E")},6930:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var n=s(4232),i=s(4613),t=s(4531);let a=()=>{let[e,r]=(0,n.useState)(null),[s,a]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),[u,c]=(0,n.useState)(!1),d=async(e,r)=>{try{var s;console.log("\uD83D\uDD0D Recherche membre avec authUserId:",e,"email:",r);let{data:n,error:t}=await i.N.from("members").select("\n          *,\n          member_groups(\n            groups(*)\n          )\n        ").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche par user_id:",{data:n,error:t}),t||!n){console.log("\uD83D\uDD0D Recherche par email...");let{data:s,error:a}=await i.N.from("members").select("\n            *,\n            member_groups(\n              groups(*)\n            )\n          ").eq("email",r).single();console.log("\uD83D\uDCCA R\xe9sultat recherche par email:",{emailData:s,emailError:a}),s&&!a&&(await i.N.from("members").update({user_id:e}).eq("id",s.id),n=s,t=a)}if(t||!n)return console.log("❌ Membre non trouv\xe9:",null==t?void 0:t.message),null;console.log("✅ Donn\xe9es membre brutes:",n);let a={...n,groups:(null==(s=n.member_groups)?void 0:s.map(e=>e.groups))||[]};return console.log("✅ Membre avec groupes:",a),a}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du membre:",e),null}},m=async()=>{try{let{data:{user:e}}=await i.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let s={id:e.id,email:e.email,user_metadata:e.user_metadata};r(s),console.log("\uD83D\uDC64 User state mis \xe0 jour:",s);let n=await d(e.id,e.email);a(n),console.log("\uD83D\uDC65 Member state mis \xe0 jour:",n)}else console.log("❌ Aucun utilisateur authentifi\xe9"),r(null),a(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),r(null),a(null)}finally{o(!1)}},p=async(e,r)=>{try{o(!0);let{error:s}=await i.N.auth.signInWithPassword({email:e,password:r});if(s)return{error:s.message};return await m(),{}}catch(e){return{error:"Erreur lors de la connexion"}}},g=async(e,r,s)=>{try{o(!0);let{error:n}=await i.N.auth.signUp({email:e,password:r,options:{data:{full_name:s}}});if(n)return{error:n.message};return{}}catch(e){return{error:"Erreur lors de l'inscription"}}},h=async()=>{o(!0),await i.N.auth.signOut(),r(null),a(null),o(!1)};return(0,n.useEffect)(()=>{m();let{data:{subscription:e}}=i.N.auth.onAuthStateChange(async(e,s)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await m():"SIGNED_OUT"===e&&(r(null),a(null),o(!1))});return()=>e.unsubscribe()},[]),(0,n.useEffect)(()=>{!async function(){if(e){let r=await (0,t._)();c(r),console.log("\uD83D\uDD11 \xc9tat admin mis \xe0 jour:",{user:e.email,isAdmin:r})}else c(!1)}()},[e]),{user:e,member:s,isLoading:l,isAdmin:u,signIn:p,signUp:g,signOut:h,refreshUser:m}}},7324:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/membres",function(){return s(3135)}])},7670:(e,r,s)=>{"use strict";s.d(r,{W:()=>t});var n=s(4232),i=s(4613);let t=()=>{let[e,r]=(0,n.useState)(null),[s,t]=(0,n.useState)(null),[a,l]=(0,n.useState)(!0),o=async(e,r)=>{try{console.log("\uD83D\uDD0D Recherche super admin avec authUserId:",e,"email:",r);let{data:s,error:n}=await i.N.from("super_admins").select("*").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche super admin:",{data:s,error:n}),n||!s)return console.log("❌ Super admin non trouv\xe9:",null==n?void 0:n.message),null;return console.log("✅ Super admin trouv\xe9:",s),s}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du super admin:",e),null}},u=async()=>{try{let{data:{user:e}}=await i.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let s={id:e.id,email:e.email,user_metadata:e.user_metadata};r(s),console.log("\uD83D\uDC64 User state mis \xe0 jour:",s);let n=await o(e.id,e.email);t(n),console.log("\uD83D\uDC51 Super admin state mis \xe0 jour:",n)}else console.log("❌ Aucun utilisateur authentifi\xe9"),r(null),t(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),r(null),t(null)}finally{l(!1)}},c=async(e,r)=>{try{l(!0);let{error:s}=await i.N.auth.signInWithPassword({email:e,password:r});if(s)return{error:s.message};return{}}catch(e){return{error:e.message||"Une erreur est survenue"}}finally{l(!1)}},d=async()=>{await i.N.auth.signOut(),r(null),t(null)};(0,n.useEffect)(()=>{u();let e=i.N.auth.onAuthStateChange(async e=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await u():"SIGNED_OUT"===e&&(r(null),t(null),l(!1))});return()=>e.data.subscription.unsubscribe()},[]);let m=!!s;return console.log("\uD83D\uDC51 \xc9tat super admin calcul\xe9:",{superAdmin:s,isSuperAdmin:m}),{user:e,superAdmin:s,isLoading:a,isSuperAdmin:m,signIn:c,signOut:d,refreshUser:u}}},8313:(e,r,s)=>{"use strict";s.d(r,{A:()=>u});var n=s(7876),i=s(8230),t=s.n(i),a=s(9099),l=s(6930),o=s(7670);function u(e){let{isAdmin:r}=e,s=(0,a.useRouter)(),{user:i,member:u,signOut:c}=(0,l.A)(),{isSuperAdmin:d}=(0,o.W)(),m=r||d;return(0,n.jsx)("nav",{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t(),{href:"/",className:"/"===s.pathname?"active":"",children:"\uD83C\uDFE0 Accueil"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t(),{href:"/identite",className:"/identite"===s.pathname?"active":"",children:"\uD83D\uDDF3️ Voter"})}),m&&(0,n.jsx)("li",{children:(0,n.jsx)(t(),{href:"/admin",className:s.pathname.startsWith("/admin")?"active":"",children:"⚙️ Administration"})}),i&&(0,n.jsxs)("li",{className:"nav-user-section",children:[(0,n.jsxs)("div",{className:"nav-user-info",children:[(0,n.jsx)("span",{className:"nav-user-name",children:u?"".concat(u.prenom," ").concat(u.nom):i.email}),m&&(0,n.jsx)("span",{className:"nav-admin-badge",children:d?"Super Admin":"Admin"})]}),(0,n.jsx)("button",{onClick:c,className:"nav-logout-btn",children:"D\xe9connexion"})]}),!i&&(0,n.jsx)("li",{children:(0,n.jsx)(t(),{href:"/auth/login",className:"/auth/login"===s.pathname?"active":"",children:"\uD83D\uDD10 Connexion"})})]})})}}},e=>{e.O(0,[166,8,636,593,792],()=>e(e.s=7324)),_N_E=e.O()}]);