(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{415:(e,s,r)=>{"use strict";r.d(s,{A:()=>c});var n=r(7876),a=r(9099),t=r(8230),l=r.n(t),i=r(6930);function c(e){let{className:s=""}=e,r=(0,a.useRouter)(),{user:t,member:c,isAdmin:d,signOut:o}=(0,i.A)();return t?(0,n.jsx)("nav",{className:"global-nav ".concat(s),children:(0,n.jsxs)("div",{className:"nav-container",children:[(0,n.jsxs)("div",{className:"nav-left",children:[(0,n.jsx)(l(),{href:"/",className:"nav-button ".concat("/"===r.pathname?"active":""),children:"\uD83C\uDFE0 Accueil"}),(0,n.jsx)(l(),{href:"/vote",className:"nav-button ".concat("/vote"===r.pathname?"active":""),children:"\uD83D\uDDF3️ Voter"}),d&&(0,n.jsx)(l(),{href:"/admin",className:"nav-button ".concat(r.pathname.startsWith("/admin")?"active":""),children:"⚙️ Administration"})]}),(0,n.jsxs)("div",{className:"nav-right",children:[(0,n.jsxs)("span",{className:"user-info",children:[(null==c?void 0:c.name)||t.email,d&&(0,n.jsx)("span",{className:"admin-indicator",children:"\uD83D\uDC51"})]}),(0,n.jsx)("button",{onClick:o,className:"nav-button logout",children:"\uD83D\uDEAA D\xe9connexion"})]})]})}):null}},2683:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>d});var n=r(7876),a=r(4232),t=r(4613),l=r(4531),i=r(6930),c=r(415);function d(){var e,s;let[r,d]=(0,a.useState)({}),[o,u]=(0,a.useState)(!0),{user:m,member:h,isAdmin:x}=(0,i.A)();return((0,a.useEffect)(()=>{!async function(){if(!m)return u(!1);try{console.log("\uD83E\uDDEA D\xe9but des tests admin pour:",m.email);let e=await (0,l._)();console.log("\uD83D\uDCCA checkIsAdmin():",e);let{data:s}=await t.N.from("super_admins").select("*").eq("user_id",m.id).single();console.log("\uD83D\uDCCA Super-admin check:",s);let{data:r}=await t.N.from("members").select("*").eq("user_id",m.id).single();console.log("\uD83D\uDCCA Member admin check:",r),d({checkIsAdminResult:e,superAdmin:s,memberAdmin:r,hookIsAdmin:x,user:m,member:h})}catch(e){console.error("❌ Erreur lors des tests:",e)}finally{u(!1)}}()},[m,x]),o)?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(c.A,{}),(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"\uD83E\uDDEA Test des Acc\xe8s Admin"}),(0,n.jsx)("p",{children:"Chargement..."})]})]}):m?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(c.A,{}),(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\uD83E\uDDEA Test des Acc\xe8s Admin"}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDC64 Informations Utilisateur"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Email:"})," ",m.email]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"User ID:"})," ",m.id]})]})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDD0D R\xe9sultats des Tests"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"p-4 border rounded",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"1. Hook useAuth isAdmin"}),(0,n.jsx)("p",{className:"font-bold ".concat(x?"text-green-600":"text-red-600"),children:x?"✅ TRUE":"❌ FALSE"})]}),(0,n.jsxs)("div",{className:"p-4 border rounded",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"2. Fonction checkIsAdmin()"}),(0,n.jsx)("p",{className:"font-bold ".concat(r.checkIsAdminResult?"text-green-600":"text-red-600"),children:r.checkIsAdminResult?"✅ TRUE":"❌ FALSE"})]}),(0,n.jsxs)("div",{className:"p-4 border rounded",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"3. Table super_admins"}),(0,n.jsx)("p",{className:"font-bold ".concat(r.superAdmin?"text-green-600":"text-red-600"),children:r.superAdmin?"✅ TROUV\xc9":"❌ PAS TROUV\xc9"}),r.superAdmin&&(0,n.jsx)("pre",{className:"mt-2 text-sm bg-gray-100 p-2 rounded",children:JSON.stringify(r.superAdmin,null,2)})]}),(0,n.jsxs)("div",{className:"p-4 border rounded",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"4. Table members (admin)"}),(0,n.jsx)("p",{className:"font-bold ".concat((null==(e=r.memberAdmin)?void 0:e.is_admin)?"text-green-600":"text-red-600"),children:(null==(s=r.memberAdmin)?void 0:s.is_admin)?"✅ ADMIN":"❌ PAS ADMIN"}),r.memberAdmin&&(0,n.jsx)("pre",{className:"mt-2 text-sm bg-gray-100 p-2 rounded",children:JSON.stringify(r.memberAdmin,null,2)})]})]})]}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83C\uDFAF Statut Final"}),(0,n.jsx)("div",{className:"p-4 rounded text-center ".concat(x?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-2xl mb-2",children:"\uD83C\uDF89 ACC\xc8S ADMIN ACCORD\xc9"}),(0,n.jsx)("p",{children:"Vous devriez pouvoir acc\xe9der \xe0 toutes les pages d'administration"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-2xl mb-2",children:"\uD83D\uDEAB ACC\xc8S ADMIN REFUS\xc9"}),(0,n.jsx)("p",{children:"V\xe9rifiez votre configuration super-admin ou membre admin"})]})}),x&&(0,n.jsx)("div",{className:"mt-4 text-center",children:(0,n.jsx)("a",{href:"/admin",className:"inline-block bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"\uD83D\uDE80 Aller \xe0 l'Administration"})})]})]})]}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(c.A,{}),(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"\uD83E\uDDEA Test des Acc\xe8s Admin"}),(0,n.jsx)("p",{className:"text-red-600",children:"❌ Vous devez \xeatre connect\xe9 pour voir cette page"})]})]})}},4531:(e,s,r)=>{"use strict";r.d(s,{_:()=>a}),r(4232);var n=r(4613);async function a(){try{let{data:{user:e}}=await n.N.auth.getUser();if(!e)return!1;let{data:s,error:r}=await n.N.from("super_admins").select("id").eq("user_id",e.id).eq("is_active",!0).single();if(!r&&s)return console.log("\uD83D\uDD11 Super-admin d\xe9tect\xe9 via table super_admins:",e.email),!0;let{data:a}=await n.N.from("members").select("is_admin").eq("user_id",e.id).single(),t=!!(null==a?void 0:a.is_admin);return console.log("\uD83D\uDD0D V\xe9rification admin membre:",{found:!!a,is_admin:null==a?void 0:a.is_admin,result:t}),t}catch(e){return console.error("Erreur lors de la v\xe9rification des droits admin:",e),!1}}},4613:(e,s,r)=>{"use strict";r.d(s,{N:()=>n});let n=(0,r(166).UU)("https://gllqzajfkkvpwnyultiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsbHF6YWpma2t2cHdueXVsdGl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODczNjcsImV4cCI6MjA3NDY2MzM2N30.B5gXCuB2XCpT11W6unXPhFC2WX-2TsPsJA7PA32qK8E")},6930:(e,s,r)=>{"use strict";r.d(s,{A:()=>l});var n=r(4232),a=r(4613),t=r(4531);let l=()=>{let[e,s]=(0,n.useState)(null),[r,l]=(0,n.useState)(null),[i,c]=(0,n.useState)(!0),[d,o]=(0,n.useState)(!1),u=async(e,s)=>{try{var r;console.log("\uD83D\uDD0D Recherche membre avec authUserId:",e,"email:",s);let{data:n,error:t}=await a.N.from("members").select("\n          *,\n          member_groups(\n            groups(*)\n          )\n        ").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche par user_id:",{data:n,error:t}),t||!n){console.log("\uD83D\uDD0D Recherche par email...");let{data:r,error:l}=await a.N.from("members").select("\n            *,\n            member_groups(\n              groups(*)\n            )\n          ").eq("email",s).single();console.log("\uD83D\uDCCA R\xe9sultat recherche par email:",{emailData:r,emailError:l}),r&&!l&&(await a.N.from("members").update({user_id:e}).eq("id",r.id),n=r,t=l)}if(t||!n)return console.log("❌ Membre non trouv\xe9:",null==t?void 0:t.message),null;console.log("✅ Donn\xe9es membre brutes:",n);let l={...n,groups:(null==(r=n.member_groups)?void 0:r.map(e=>e.groups))||[]};return console.log("✅ Membre avec groupes:",l),l}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du membre:",e),null}},m=async()=>{try{let{data:{user:e}}=await a.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let r={id:e.id,email:e.email,user_metadata:e.user_metadata};s(e=>(null==e?void 0:e.id)===r.id?e:r),console.log("\uD83D\uDC64 User state mis \xe0 jour:",r);let n=await u(e.id,e.email);l(e=>(null==e?void 0:e.user_id)===(null==n?void 0:n.user_id)?e:n),console.log("\uD83D\uDC65 Member state mis \xe0 jour:",n)}else console.log("❌ Aucun utilisateur authentifi\xe9"),s(null),l(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),s(null),l(null)}finally{c(!1)}},h=async(e,s)=>{try{c(!0);let{error:r}=await a.N.auth.signInWithPassword({email:e,password:s});if(r)return{error:r.message};return await m(),{}}catch(e){return{error:"Erreur lors de la connexion"}}},x=async(e,s,r)=>{try{c(!0);let{error:n}=await a.N.auth.signUp({email:e,password:s,options:{data:{full_name:r}}});if(n)return{error:n.message};return{}}catch(e){return{error:"Erreur lors de l'inscription"}}},b=async()=>{c(!0),await a.N.auth.signOut(),s(null),l(null),c(!1)};return(0,n.useEffect)(()=>{m();let{data:{subscription:e}}=a.N.auth.onAuthStateChange(async(e,r)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await m():"SIGNED_OUT"===e&&(s(null),l(null),c(!1))});return()=>e.unsubscribe()},[]),(0,n.useEffect)(()=>{!async function(){if(null==e?void 0:e.id){let s=await (0,t._)();o(s),console.log("\uD83D\uDD11 \xc9tat admin mis \xe0 jour:",{user:e.email,isAdmin:s})}else o(!1)}()},[null==e?void 0:e.id]),{user:e,member:r,isLoading:i,isAdmin:d,signIn:h,signUp:x,signOut:b,refreshUser:m}}},9682:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin-test",function(){return r(2683)}])}},e=>{e.O(0,[166,8,636,593,792],()=>e(e.s=9682)),_N_E=e.O()}]);