(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{4531:(e,r,s)=>{"use strict";s.d(r,{_:()=>t}),s(4232);var a=s(4613);async function t(){try{let{data:{user:e}}=await a.N.auth.getUser();if(!e)return!1;let{data:r,error:s}=await a.N.from("super_admins").select("id").eq("user_id",e.id).eq("is_active",!0).single();if(!s&&r)return console.log("\uD83D\uDD11 Super-admin d\xe9tect\xe9 via table super_admins:",e.email),!0;let{data:t}=await a.N.from("members").select("is_admin").eq("user_id",e.id).single(),l=!!(null==t?void 0:t.is_admin);return console.log("\uD83D\uDD0D V\xe9rification admin membre:",{found:!!t,is_admin:null==t?void 0:t.is_admin,result:l}),l}catch(e){return console.error("Erreur lors de la v\xe9rification des droits admin:",e),!1}}},4613:(e,r,s)=>{"use strict";s.d(r,{N:()=>a});let a=(0,s(166).UU)("https://gllqzajfkkvpwnyultiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsbHF6YWpma2t2cHdueXVsdGl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODczNjcsImV4cCI6MjA3NDY2MzM2N30.B5gXCuB2XCpT11W6unXPhFC2WX-2TsPsJA7PA32qK8E")},6930:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var a=s(4232),t=s(4613),l=s(4531);let i=()=>{let[e,r]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[n,o]=(0,a.useState)(!0),[u,c]=(0,a.useState)(!1),d=async(e,r)=>{try{var s;console.log("\uD83D\uDD0D Recherche membre avec authUserId:",e,"email:",r);let{data:a,error:l}=await t.N.from("members").select("\n          *,\n          member_groups(\n            groups(*)\n          )\n        ").eq("user_id",e).single();if(console.log("\uD83D\uDCCA R\xe9sultat recherche par user_id:",{data:a,error:l}),l||!a){console.log("\uD83D\uDD0D Recherche par email...");let{data:s,error:i}=await t.N.from("members").select("\n            *,\n            member_groups(\n              groups(*)\n            )\n          ").eq("email",r).single();console.log("\uD83D\uDCCA R\xe9sultat recherche par email:",{emailData:s,emailError:i}),s&&!i&&(await t.N.from("members").update({user_id:e}).eq("id",s.id),a=s,l=i)}if(l||!a)return console.log("❌ Membre non trouv\xe9:",null==l?void 0:l.message),null;console.log("✅ Donn\xe9es membre brutes:",a);let i={...a,groups:(null==(s=a.member_groups)?void 0:s.map(e=>e.groups))||[]};return console.log("✅ Membre avec groupes:",i),i}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du membre:",e),null}},m=async()=>{try{let{data:{user:e}}=await t.N.auth.getUser();if(console.log("\uD83D\uDD10 Auth user r\xe9cup\xe9r\xe9:",e),e){let s={id:e.id,email:e.email,user_metadata:e.user_metadata};r(s),console.log("\uD83D\uDC64 User state mis \xe0 jour:",s);let a=await d(e.id,e.email);i(a),console.log("\uD83D\uDC65 Member state mis \xe0 jour:",a)}else console.log("❌ Aucun utilisateur authentifi\xe9"),r(null),i(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",e),r(null),i(null)}finally{o(!1)}},h=async(e,r)=>{try{o(!0);let{error:s}=await t.N.auth.signInWithPassword({email:e,password:r});if(s)return{error:s.message};return await m(),{}}catch(e){return{error:"Erreur lors de la connexion"}}},p=async(e,r,s)=>{try{o(!0);let{error:a}=await t.N.auth.signUp({email:e,password:r,options:{data:{full_name:s}}});if(a)return{error:a.message};return{}}catch(e){return{error:"Erreur lors de l'inscription"}}},g=async()=>{o(!0),await t.N.auth.signOut(),r(null),i(null),o(!1)};return(0,a.useEffect)(()=>{m();let{data:{subscription:e}}=t.N.auth.onAuthStateChange(async(e,s)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await m():"SIGNED_OUT"===e&&(r(null),i(null),o(!1))});return()=>e.unsubscribe()},[]),(0,a.useEffect)(()=>{!async function(){if(e){let r=await (0,l._)();c(r),console.log("\uD83D\uDD11 \xc9tat admin mis \xe0 jour:",{user:e.email,isAdmin:r})}else c(!1)}()},[e]),{user:e,member:s,isLoading:n,isAdmin:u,signIn:h,signUp:p,signOut:g,refreshUser:m}}},7984:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return s(9416)}])},9416:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>u});var a=s(7876),t=s(4232),l=s(9099),i=s(8230),n=s.n(i),o=s(6930);function u(){let[e,r]=(0,t.useState)(""),[s,i]=(0,t.useState)(""),[u,c]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),{signIn:h,user:p,member:g}=(0,o.A)(),f=(0,l.useRouter)();(0,t.useEffect)(()=>{p&&g?f.push("/admin"):p&&!g&&m("Votre email n'est pas associ\xe9 \xe0 un membre enregistr\xe9. Contactez un administrateur.")},[p,g,f]);let v=async r=>{r.preventDefault(),c(!0),m("");let{error:a}=await h(e,s);a&&(a.includes("Invalid login credentials")?m("Email ou mot de passe incorrect"):a.includes("Email not confirmed")?m("Veuillez confirmer votre adresse email avant de vous connecter"):m(a)),c(!1)};return(0,a.jsx)("div",{className:"auth-container",children:(0,a.jsxs)("div",{className:"auth-card",children:[(0,a.jsxs)("div",{className:"auth-header",children:[(0,a.jsx)("h1",{children:"\uD83D\uDDF3️ Connexion"}),(0,a.jsx)("p",{children:"Connectez-vous avec votre adresse email de membre"})]}),d&&(0,a.jsx)("div",{className:"alert alert-error",children:(0,a.jsxs)("span",{children:["⚠️ ",d]})}),(0,a.jsxs)("form",{onSubmit:v,className:"auth-form",children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"email",children:"Adresse email"}),(0,a.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>r(e.target.value),placeholder:"votre@email.com",required:!0,disabled:u}),(0,a.jsx)("small",{children:"Utilisez l'email associ\xe9 \xe0 votre compte membre"})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),(0,a.jsx)("input",{id:"password",type:"password",value:s,onChange:e=>i(e.target.value),placeholder:"••••••••",required:!0,disabled:u})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary btn-full",disabled:u,children:u?"\uD83D\uDD04 Connexion...":"\uD83D\uDE80 Se connecter"})]}),(0,a.jsx)("div",{className:"auth-center",children:(0,a.jsx)(n(),{href:"/forgot-password",className:"link-primary",children:"\uD83D\uDD11 Mot de passe oubli\xe9 ?"})}),(0,a.jsxs)("div",{className:"auth-footer",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"⚠️ Acc\xe8s limit\xe9 aux membres enregistr\xe9s"})}),(0,a.jsx)("p",{children:"Seuls les membres avec une adresse email associ\xe9e peuvent acc\xe9der \xe0 la plateforme. Contactez un administrateur si vous n'avez pas encore d'acc\xe8s."}),(0,a.jsx)("div",{className:"auth-links",children:(0,a.jsx)(n(),{href:"/",className:"link-secondary",children:"← Retour \xe0 l'accueil"})})]})]})})}}},e=>{e.O(0,[166,8,636,593,792],()=>e(e.s=7984)),_N_E=e.O()}]);