(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{2700:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/results/[editionId]",function(){return i(8041)}])},4613:(e,t,i)=>{"use strict";i.d(t,{N:()=>n});let n=(0,i(166).UU)("https://gllqzajfkkvpwnyultiy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsbHF6YWpma2t2cHdueXVsdGl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODczNjcsImV4cCI6MjA3NDY2MzM2N30.B5gXCuB2XCpT11W6unXPhFC2WX-2TsPsJA7PA32qK8E")},8041:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(7876),r=i(4232),s=i(9099),a=i(4613),d=i(8230),l=i.n(d);function o(){let e=(0,s.useRouter)(),{editionId:t}=e.query,[i,d]=(0,r.useState)(!0),[o,c]=(0,r.useState)(""),[x,u]=(0,r.useState)(null),[m,h]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[f,j]=(0,r.useState)([]),[v,b]=(0,r.useState)(!1);async function y(e){try{let[r,s,d]=await Promise.all([a.N.from("editions_questions").select("question_id").eq("edition_id",e.id),a.N.from("members").select("id, name, group_id").eq("group_id",e.group_id).order("name"),a.N.from("votes").select("id, question_id, voter_id, member_id, ranking").eq("edition_id",e.id)]);if(!r.data||0===r.data.length){g([]),j(s.data||[]),h([]);return}let l=r.data.map(e=>e.question_id),{data:o}=await a.N.from("questions").select("id, text").in("id",l);if(g(o||[]),j(s.data||[]),o&&s.data&&d.data){var t,i,n;let e=(t=o,i=s.data,n=d.data,t.map(e=>{let t=n.filter(t=>t.question_id===e.id);return{question:e,memberScores:i.map(e=>{let i=t.filter(t=>t.member_id===e.id);if(0===i.length)return{member:e,averageRank:null,voteCount:0,totalPoints:0};let n=i.reduce((e,t)=>e+t.ranking,0)/i.length,r=Math.max(...t.map(e=>e.ranking)),s=i.reduce((e,t)=>e+(r+1-t.ranking),0);return{member:e,averageRank:n,voteCount:i.length,totalPoints:s,votes:i}}).filter(e=>null!==e.averageRank).sort((e,t)=>e.averageRank-t.averageRank),totalVotes:t.length}}));h(e)}}catch(e){console.error("Erreur lors du chargement des r\xe9sultats:",e)}}return((0,r.useEffect)(()=>{!async function(){try{let{data:{user:i}}=await a.N.auth.getUser();if(!i)return void e.push("/login");let{data:n}=await a.N.from("members").select("*").eq("user_id",i.id).single();if(!n)return void c("Acc\xe8s non autoris\xe9");if(t){let{data:e}=await a.N.from("editions").select("*").eq("id",t).single();if(e){u(e);let{data:t}=await a.N.from("member_groups").select("*").eq("member_id",n.id).eq("group_id",e.group_id).single();(t||n.is_admin)&&(b(!0),await y(e))}}d(!1)}catch(e){console.error("Erreur d'authentification:",e),d(!1)}}()},[t,e]),i)?(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"page-container",children:(0,n.jsx)("div",{className:"loading",children:"Chargement..."})})}):o?(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"page-container",children:(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,n.jsx)("h2",{children:"❌ Erreur"}),(0,n.jsx)("p",{children:o}),(0,n.jsx)(l(),{href:"/",className:"btn btn-primary",style:{marginTop:"20px"},children:"Retour \xe0 l'accueil"})]})})}):v&&x?(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("nav",{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(l(),{href:"/",className:"active",children:"\uD83C\uDFE0 Accueil"})}),(0,n.jsx)("li",{children:(0,n.jsx)(l(),{href:"/identite",children:"\uD83D\uDDF3️ Voter"})})]})}),(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsx)("h1",{children:"\uD83C\uDFC6 R\xe9sultats des votes"}),(0,n.jsxs)("div",{style:{marginBottom:"30px",padding:"20px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,n.jsx)("h2",{style:{margin:"0 0 10px 0",color:"#333"},children:x.title}),(0,n.jsx)("div",{style:{display:"flex",gap:"20px",alignItems:"center",flexWrap:"wrap"},children:(0,n.jsx)(l(),{href:"/admin/votes?edition=".concat(x.id),className:"btn btn-secondary",style:{textDecoration:"none",display:"inline-flex",alignItems:"center",gap:"8px"},children:"\uD83D\uDCCA Voir les d\xe9tails des votes"})})]}),0===p.length&&(0,n.jsx)("div",{className:"warning",children:"Aucune question n'est associ\xe9e \xe0 cette \xe9dition."}),m.map((e,t)=>{var i,r,s,a,d,l;return(0,n.jsxs)("div",{style:{marginBottom:"50px",background:"white",padding:"30px",borderRadius:"8px",border:"1px solid #dee2e6"},children:[(0,n.jsx)("h2",{style:{color:"#495057",marginBottom:"20px"},children:e.question.text}),(0,n.jsxs)("div",{style:{color:"#666",marginBottom:"20px",fontSize:"14px"},children:[e.totalVotes," vote(s) • ",e.memberScores.length," participant(s) class\xe9(s)"]}),0===e.memberScores.length?(0,n.jsx)("div",{className:"warning",children:"Aucun vote pour cette question"}):(0,n.jsxs)("div",{children:[e.memberScores.length>=3&&(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"end",marginBottom:"30px",gap:"20px"},children:[(0,n.jsxs)("div",{style:{textAlign:"center",background:"#f8f9fa",padding:"20px",borderRadius:"8px",minWidth:"120px"},children:[(0,n.jsx)("div",{style:{fontSize:"40px"},children:"\uD83E\uDD48"}),(0,n.jsx)("div",{style:{fontWeight:"bold",fontSize:"18px"},children:null==(i=e.memberScores[1])?void 0:i.member.name}),(0,n.jsxs)("div",{style:{color:"#666",fontSize:"14px"},children:["Rang moyen: ",null==(r=e.memberScores[1])?void 0:r.averageRank.toFixed(2)]})]}),(0,n.jsxs)("div",{style:{textAlign:"center",background:"#fff3cd",padding:"30px 20px",borderRadius:"8px",minWidth:"120px",border:"2px solid #ffc107"},children:[(0,n.jsx)("div",{style:{fontSize:"50px"},children:"\uD83E\uDD47"}),(0,n.jsx)("div",{style:{fontWeight:"bold",fontSize:"20px",color:"#856404"},children:null==(s=e.memberScores[0])?void 0:s.member.name}),(0,n.jsxs)("div",{style:{color:"#856404",fontSize:"14px"},children:["Rang moyen: ",null==(a=e.memberScores[0])?void 0:a.averageRank.toFixed(2)]})]}),(0,n.jsxs)("div",{style:{textAlign:"center",background:"#f8f9fa",padding:"20px",borderRadius:"8px",minWidth:"120px"},children:[(0,n.jsx)("div",{style:{fontSize:"40px"},children:"\uD83E\uDD49"}),(0,n.jsx)("div",{style:{fontWeight:"bold",fontSize:"18px"},children:null==(d=e.memberScores[2])?void 0:d.member.name}),(0,n.jsxs)("div",{style:{color:"#666",fontSize:"14px"},children:["Rang moyen: ",null==(l=e.memberScores[2])?void 0:l.averageRank.toFixed(2)]})]})]}),(0,n.jsxs)("table",{style:{marginTop:"20px"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Rang"}),(0,n.jsx)("th",{children:"Participant"}),(0,n.jsx)("th",{children:"Rang moyen"}),(0,n.jsx)("th",{children:"Nombre de votes"}),(0,n.jsx)("th",{children:"Points totaux"})]})}),(0,n.jsx)("tbody",{children:e.memberScores.map((t,i)=>(0,n.jsxs)("tr",{style:{background:i<3?function(e,t){if(1===e)return"#gold";if(2===e)return"#silver";if(3===e)return"#cd7f32";let i=(e-1)/(t-1),n=Math.floor(255*i),r=Math.floor(255*(1-i));return"rgb(".concat(n,", ").concat(r,", 100)")}(i+1,e.memberScores.length):"transparent"},children:[(0,n.jsxs)("td",{style:{textAlign:"center",fontWeight:"bold",fontSize:"18px"},children:["#",i+1]}),(0,n.jsx)("td",{style:{fontWeight:"bold"},children:t.member.name}),(0,n.jsx)("td",{style:{textAlign:"center"},children:t.averageRank.toFixed(2)}),(0,n.jsx)("td",{style:{textAlign:"center"},children:t.voteCount}),(0,n.jsx)("td",{style:{textAlign:"center"},children:t.totalPoints})]},t.member.id))})]})]})]},e.question.id)})]})]}):(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"page-container",children:(0,n.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,n.jsx)("h2",{children:"� Acc\xe8s refus\xe9"}),(0,n.jsx)("p",{children:"Vous n'avez pas l'autorisation d'acc\xe9der \xe0 cette page."}),(0,n.jsx)(l(),{href:"/",className:"btn btn-primary",style:{marginTop:"20px"},children:"Retour \xe0 l'accueil"})]})})})}}},e=>{e.O(0,[166,8,636,593,792],()=>e(e.s=2700)),_N_E=e.O()}]);